<!DOCTYPE HTML><html><head><title>/README.md.dhall</title><link href="index.css" type="text/css" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&amp;family=Lato:ital,wght@0,400;0,700;1,400&amp;display=swap" type="text/css" rel="stylesheet"><script src="index.js" type="text/javascript"></script><meta charset="UTF-8"></head><body><div class="nav-bar"><img src="dhall-icon.svg" class="dhall-icon"><p class="package-title">dhall-aws-cloudformation</p><div class="nav-bar-content-divider"></div><a id="switch-light-dark-mode" class="nav-option">Switch Light/Dark Mode</a></div><div class="main-container"><h2 class="doc-title"><span class="crumb-divider">/</span><a href="index.html">dhall-aws-cloudformation</a><span class="crumb-divider">/</span><span href="index.html" class="title-crumb">README.md.dhall</span></h2><a data-path="https://raw.githubusercontent.com/jcouyang/dhall-aws-cloudformation/0.9.69/README.md.dhall" class="copy-to-clipboard"><i><small>Copy path to clipboard</small></i></a><br><div class="doc-contents"></div><h3>Source</h3><div class="source-code"><pre>let <span data-name="var1-5" id="var1-5" class="name-decl">version</span> = <a href="./version.dhall.html">./version.dhall</a><br><br>let <span data-name="var3-5" id="var3-5" class="name-decl">config</span> = <a href="./config.dhall.html">./config.dhall</a><br><br>let <span data-name="var5-5" id="var5-5" class="name-decl">fold</span> =<br>      <a href="https://github.com/dhall-lang/dhall-lang/raw/v20.0.0/Prelude/List/fold.dhall" target="_blank">https://github.com/dhall-lang/dhall-lang/raw/v20.0.0/Prelude/List/fold.dhall</a><br><br>let <span data-name="var8-5" id="var8-5" class="name-decl">exampleText</span> = <a href="./examples/readme.gen.dhall.html">./examples/readme.gen.dhall as Text</a><br><br>let <span data-name="var10-5" id="var10-5" class="name-decl">exampleResult</span> = <a href="./examples/readme.gen.json.html">./examples/readme.gen.json as Text</a><br><br>in  &#39;&#39;<br>    # Dhall AWS CloudFormation<br><br>    `dhall-aws-cloudformation` contains [Dhall](https://github.com/dhall-lang/dhall-lang) bindings to AWS CloudFormation, so you can generate CloudFormation template from Dhall expressions. This will let you easily typecheck, template and modularize your CloudFormation definitions.<br><br>    ## :mag: [References](https://oyanglul.us/dhall-aws-cloudformation/package.dhall.html)<br>    ## :bulb: [Examples](https://oyanglul.us/dhall-aws-cloudformation/examples/index.html)<br><br>    ## :book: Usage<br><br>    ### Use resource schema<br>    AWS Cloudformation has massive amount of specifications, to load all `package.dhall` remotely will be very slow<br><br>    It is recommended to just import the only resources you need<br><br>    &gt;  optionaly, if you really need all resources in `package.dhall`, [load the binary cache to local first](https://oyanglul.us/dhall-aws-cloudformation/package.dhall.html#load-packagedhall-binary-to-local-cache)<br><br>    ```dhall<br>    ${<a href="#var8-5" data-name="var8-5" class="name-use">exampleText</a>}```<br><br>    to convert to CloudFormation JSON file just<br>    ```<br>    dhall-to-json &lt; ./template.dhall &gt; ./template.json<br>    ```<br><br>    generates<br><br>    ```json<br>    ${<a href="#var10-5" data-name="var10-5" class="name-use">exampleResult</a>}```<br><br>    ### Intrinsic Function<br><br>    The following intrinsic functions are implemented, you can find examples of using intrinsic function in [Fn.dhall document](https://oyanglul.us/dhall-aws-cloudformation/Fn.dhall.html)<br>    - [x] Fn::Base64<br>    - [x] Fn::Cidr<br>    - [x] Condition functions<br>    - [x] Fn::FindInMap<br>    - [x] Fn::GetAtt<br>    - [x] Fn::GetAZs<br>    - [x] Fn::ImportValue<br>    - [x] Fn::Join<br>    - [x] Fn::Select<br>    - [x] Fn::Split<br>    - [x] Fn::Sub<br>    - [x] Fn::Transform<br>    - [x] Ref<br><br>    ### Type Safe `Fn::GetAttr`<br>    Instead of manually looking for AWS documents to make sure the resource has what attributes, we can just use `&lt;Resource&gt;.GetAttr.&lt;attribute name&gt;`:<br><br>    ```dhall<br>    render (Role.GetAttr.Arn &quot;HelloWorldFunctionRole&quot;)<br>    ```<br><br>    So the compiler can just help you find the correct attributes available.<br><br>    ### Sam Policy Templates<br>    Cloudformation&#39;s Policy document is loosy type as just JSON, it is hard to get the policy right and too many boilerplates to create a Dhall JSON data<br><br>    Thanks to [AWS SAM](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-policy-templates.html) there are some common policy documents we can laverage<br><br>    All these templates are translated into Dhall functions, so you don&#39;t need to use SAM to be able to use these policy documents.<br><br>    ```dhall<br>    let Policy = https://github.com/jcouyang/dhall-aws-cloudformation/raw/${<a href="#var1-5" data-name="var1-5" class="name-use">version</a>}/cloudformation/AWS::IAM::Role/Policy.dhall<br>    let Sam/Policy = https://github.com/jcouyang/dhall-aws-cloudformation/raw/${<a href="#var1-5" data-name="var1-5" class="name-use">version</a>}/sam/policy-template/package.dhall<br>    ...<br>      Policies = Some [Policy::{<br>        , PolicyDocument = Sam/Policy.DynamoDBReadPolicy (Fn.String &quot;DBName&quot;)<br>        , PolicyName = s &quot;dynamo read only&quot;<br>      }]<br>    ...<br>    ```<br><br>    will generates<br><br>    ```json<br>    {<br>      &quot;Policies&quot;: [<br>        {<br>          &quot;PolicyDocument&quot;: {<br>            &quot;Statement&quot;: [<br>              {<br>                &quot;Action&quot;: [<br>                  &quot;dynamodb:GetItem&quot;,<br>                  &quot;dynamodb:Scan&quot;,<br>                  &quot;dynamodb:Query&quot;,<br>                  &quot;dynamodb:BatchGetItem&quot;,<br>                  &quot;dynamodb:DescribeTable&quot;<br>                ],<br>                &quot;Effect&quot;: &quot;Allow&quot;,<br>                &quot;Resource&quot;: [<br>                  {<br>                    &quot;Fn::Sub&quot;: [<br>                      &quot;arn:&#39;&#39;${AWS::Partition}:dynamodb:&#39;&#39;${AWS::Region}:&#39;&#39;${AWS::AccountId}:table/&#39;&#39;${tableName}&quot;,<br>                      {<br>                        &quot;tableName&quot;: &quot;DBName&quot;<br>                      }<br>                    ]<br>                  },<br>                  {<br>                    &quot;Fn::Sub&quot;: [<br>                      &quot;arn:&#39;&#39;${AWS::Partition}:dynamodb:&#39;&#39;${AWS::Region}:&#39;&#39;${AWS::AccountId}:table/&#39;&#39;${tableName}/index/*&quot;,<br>                      {<br>                        &quot;tableName&quot;: &quot;DBName&quot;<br>                      }<br>                    ]<br>                  }<br>                ]<br>              }<br>            ]<br>          },<br>          &quot;PolicyName&quot;: &quot;dynamo read only&quot;<br>        }<br>      ]<br>    }<br>    ```<br>    ## :coffee: Contribute<br>    ### Build and Test<br><br>    ```<br>    &gt; nix-shell<br>    $ stack build<br>    $ stack test<br>    ```<br>    ### Generate Type Definitions<br><br>    Type definitions are generated from config file `./config.dhall` which contains specifications used by [AWS CDK](https://github.com/aws/aws-cdk/blob/master/packages/%40aws-cdk/cfnspec/build-tools/update.sh) as well:<br>    ${<a href="#var5-5" data-name="var5-5" class="name-use">fold</a><br>        { mapKey : Text, mapValue : Text }<br>        <a href="#var3-5" data-name="var3-5" class="name-use">config</a>.specifications<br>        Text<br>        ( λ(<span data-name="var144-13" id="var144-13" class="name-decl">x</span> : { <span data-name="var144-19" id="var144-19" class="name-decl">mapKey</span> : Text, <span data-name="var144-34" id="var144-34" class="name-decl">mapValue</span> : Text }) →<br>          λ(<span data-name="var145-13" id="var145-13" class="name-decl">y</span> : Text) →<br>            &#39;&#39;<br>            - [${<a href="#var144-13" data-name="var144-13" class="name-use">x</a>.<a href="#var144-19" data-name="var144-19" class="name-use">mapKey</a>}](${<a href="#var144-13" data-name="var144-13" class="name-use">x</a>.<a href="#var144-34" data-name="var144-34" class="name-use">mapValue</a>})<br>            ${<a href="#var145-13" data-name="var145-13" class="name-use">y</a>}&#39;&#39;<br>        )<br>        &quot;&quot;}<br><br>    To regenerate types definition files, simply run<br>    ```<br>    $ stack run<br>    ```<br><br>    Or if you just want to regenerate dhall files without setting up haskell dev environment, just<br>    ```sh<br>    docker run --rm -v $(pwd):/data -w /data ghcr.io/jcouyang/dhall-aws-cloudformation<br>    ```<br><br>    ## :warning: Known Issue<br>    The following CloudFormation definitions will raise assertion error due to invalid type definition such as empty type or cyclic import<br><br>    ${<a href="#var5-5" data-name="var5-5" class="name-use">fold</a><br>        Text<br>        <a href="#var3-5" data-name="var3-5" class="name-use">config</a>.excludes<br>        Text<br>        ( λ(<span data-name="var169-13" id="var169-13" class="name-decl">x</span> : Text) →<br>          λ(<span data-name="var170-13" id="var170-13" class="name-decl">y</span> : Text) →<br>            &#39;&#39;<br>            - `${<a href="#var169-13" data-name="var169-13" class="name-use">x</a>}`<br>            ${<a href="#var170-13" data-name="var170-13" class="name-use">y</a>}&#39;&#39;<br>        )<br>        &quot;&quot;}<br>    &#39;&#39;<br></pre></div></div></body></html>