<!DOCTYPE HTML><html><head><title>/gh-pages/README.md.dhall.html</title><link rel="stylesheet" type="text/css" href="../index.css"><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&amp;family=Lato:ital,wght@0,400;0,700;1,400&amp;display=swap"><script type="text/javascript" src="../index.js"></script><meta charset="UTF-8"></head><body><div class="nav-bar"><img class="dhall-icon" src="../dhall-icon.svg"><p class="package-title">dhall-aws-cloudformation</p><div class="nav-bar-content-divider"></div><a id="switch-light-dark-mode" class="nav-option">Switch Light/Dark Mode</a></div><div class="main-container"><h2 class="doc-title"><span class="crumb-divider">/</span><a href="../index.html">dhall-aws-cloudformation</a><span class="crumb-divider">/</span><a class="title-crumb" href="index.html">gh-pages</a><span class="crumb-divider">/</span><span class="title-crumb" href="index.html">README.md.dhall.html</span></h2><a class="copy-to-clipboard" data-path="https://raw.githubusercontent.com/jcouyang/dhall-aws-cloudformation/0.9.80/gh-pages/README.md.dhall.html"><i><small>Copy path to clipboard</small></i></a><br><h3>Source</h3><div class="source-code">&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;/README.md.dhall&lt;/title&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;index.css&quot;&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&amp;amp;family=Lato:ital,wght@0,400;0,700;1,400&amp;amp;display=swap&quot;&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;index.js&quot;&gt;&lt;/script&gt;&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;nav-bar&quot;&gt;&lt;img class=&quot;dhall-icon&quot; src=&quot;dhall-icon.svg&quot;&gt;&lt;p class=&quot;package-title&quot;&gt;dhall-aws-cloudformation&lt;/p&gt;&lt;div class=&quot;nav-bar-content-divider&quot;&gt;&lt;/div&gt;&lt;a id=&quot;switch-light-dark-mode&quot; class=&quot;nav-option&quot;&gt;Switch Light/Dark Mode&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;main-container&quot;&gt;&lt;h2 class=&quot;doc-title&quot;&gt;&lt;span class=&quot;crumb-divider&quot;&gt;/&lt;/span&gt;&lt;a href=&quot;index.html&quot;&gt;dhall-aws-cloudformation&lt;/a&gt;&lt;span class=&quot;crumb-divider&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;title-crumb&quot; href=&quot;index.html&quot;&gt;README.md.dhall&lt;/span&gt;&lt;/h2&gt;&lt;a class=&quot;copy-to-clipboard&quot; data-path=&quot;https://raw.githubusercontent.com/jcouyang/dhall-aws-cloudformation/0.9.79/README.md.dhall&quot;&gt;&lt;i&gt;&lt;small&gt;Copy path to clipboard&lt;/small&gt;&lt;/i&gt;&lt;/a&gt;&lt;br&gt;&lt;div class=&quot;doc-contents&quot;&gt;&lt;/div&gt;&lt;h3&gt;Source&lt;/h3&gt;&lt;div class=&quot;source-code&quot;&gt;&lt;pre&gt;let &lt;span id=&quot;var1-5&quot; class=&quot;name-decl&quot; data-name=&quot;var1-5&quot;&gt;version&lt;/span&gt; = &lt;a href=&quot;./version.dhall.html&quot;&gt;./version.dhall&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span id=&quot;var3-5&quot; class=&quot;name-decl&quot; data-name=&quot;var3-5&quot;&gt;config&lt;/span&gt; = &lt;a href=&quot;./config.dhall.html&quot;&gt;./config.dhall&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span id=&quot;var5-5&quot; class=&quot;name-decl&quot; data-name=&quot;var5-5&quot;&gt;fold&lt;/span&gt; =&lt;br&gt;      &lt;a href=&quot;https://github.com/dhall-lang/dhall-lang/raw/v20.0.0/Prelude/List/fold.dhall&quot; target=&quot;_blank&quot;&gt;https://github.com/dhall-lang/dhall-lang/raw/v20.0.0/Prelude/List/fold.dhall&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span id=&quot;var8-5&quot; class=&quot;name-decl&quot; data-name=&quot;var8-5&quot;&gt;exampleText&lt;/span&gt; = &lt;a href=&quot;./examples/readme.gen.dhall.html&quot;&gt;./examples/readme.gen.dhall as Text&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span id=&quot;var10-5&quot; class=&quot;name-decl&quot; data-name=&quot;var10-5&quot;&gt;exampleResult&lt;/span&gt; = &lt;a href=&quot;./examples/readme.gen.json.html&quot;&gt;./examples/readme.gen.json as Text&lt;/a&gt;&lt;br&gt;&lt;br&gt;in  &amp;#39;&amp;#39;&lt;br&gt;# Dhall AWS CloudFormation&lt;br&gt;&lt;br&gt;`dhall-aws-cloudformation` contains [Dhall](https://github.com/dhall-lang/dhall-lang) bindings to AWS CloudFormation, so you can generate CloudFormation template from Dhall expressions. This will let you easily typecheck, template and modularize your CloudFormation definitions.&lt;br&gt;&lt;br&gt;## :mag: [References](https://gh.1punch.dev/dhall-aws-cloudformation/package.dhall.html)&lt;br&gt;## :bulb: [Examples](https://gh.1punch.dev/dhall-aws-cloudformation/examples/index.html)&lt;br&gt;&lt;br&gt;## :book: Usage&lt;br&gt;&lt;br&gt;### Use resource schema&lt;br&gt;AWS Cloudformation has massive amount of specifications, to load all&lt;br&gt;dhall remotely will be very slow and impractical.&lt;br&gt;&lt;br&gt;One simply way to make import faster is by only importing just each resource you need&lt;br&gt;#### Remote import resource&lt;br&gt;```dhall&lt;br&gt;${&lt;a href=&quot;#var8-5&quot; class=&quot;name-use&quot; data-name=&quot;var8-5&quot;&gt;exampleText&lt;/a&gt;}&lt;br&gt;```&lt;br&gt;&lt;br&gt;to convert to CloudFormation JSON file just&lt;br&gt;&lt;br&gt;```&lt;br&gt;dhall-to-json &amp;lt; ./template.dhall &amp;gt; ./template.json&lt;br&gt;```&lt;br&gt;&lt;br&gt;which generates&lt;br&gt;&lt;br&gt;```json&lt;br&gt;${&lt;a href=&quot;#var10-5&quot; class=&quot;name-use&quot; data-name=&quot;var10-5&quot;&gt;exampleResult&lt;/a&gt;}&lt;br&gt;```&lt;br&gt;&lt;br&gt;Other way around is build the binary of subset of the resources using nix&lt;br&gt;&lt;br&gt;#### Build and load package.dhall binary to local cache&lt;br&gt;&lt;br&gt;Have something like `./examples/example0.nix`, and the dhall file you want to compile `./examples/example0.dhall`&lt;br&gt;&lt;br&gt;```nix&lt;br&gt;${&lt;a href=&quot;./examples/example0.dhall.html&quot;&gt;./examples/example0.dhall as Text&lt;/a&gt;}&lt;br&gt;```&lt;br&gt;Add all the resources you need to `cf-preset`, run nix-build, if the subset is not too large it will be very quick, and you will see something like:&lt;br&gt;```&lt;br&gt; ⚠ ─ If error occured, you may need to update the sha256 in your dhall file e.g.&lt;br&gt; │ let aws = missing sha256:a04e4db67b092e40987639cca5cd845f452b3984ee7ec77172f815a31e830325&lt;br&gt;```&lt;br&gt;&lt;br&gt;Actually the first time it will fail since you can&amp;#39;t guess the correct sha of the subset binary, now if you update example0.dhall with the correct sha,&lt;br&gt;it should then be able to compile to `./result/example0.yaml`&lt;br&gt;```dhall&lt;br&gt;let aws =&lt;br&gt;missing&lt;br&gt;sha256:a04e4db67b092e40987639cca5cd845f452b3984ee7ec77172f815a31e830325&lt;br&gt;&lt;br&gt;let Function = aws.Cloudformation.`AWS::Lambda::Function`&lt;br&gt;```&lt;br&gt;&lt;br&gt;### Intrinsic Function&lt;br&gt;&lt;br&gt;The following intrinsic functions are implemented, you can find examples of using intrinsic function in [Fn.dhall document](https://oyanglul.us/dhall-aws-cloudformation/Fn.dhall.html)&lt;br&gt;- [x] Fn::Base64&lt;br&gt;- [x] Fn::Cidr&lt;br&gt;- [x] Condition functions&lt;br&gt;- [x] Fn::FindInMap&lt;br&gt;- [x] Fn::GetAtt&lt;br&gt;- [x] Fn::GetAZs&lt;br&gt;- [x] Fn::ImportValue&lt;br&gt;- [x] Fn::Join&lt;br&gt;- [x] Fn::Select&lt;br&gt;- [x] Fn::Split&lt;br&gt;- [x] Fn::Sub&lt;br&gt;- [x] Fn::Transform&lt;br&gt;- [x] Ref&lt;br&gt;&lt;br&gt;### Type Safe `Fn::GetAttr`&lt;br&gt;Instead of manually looking for AWS documents to make sure the resource has what attributes, we can just use `&amp;lt;Resource&amp;gt;.GetAttr.&amp;lt;attribute name&amp;gt;`:&lt;br&gt;&lt;br&gt;```dhall&lt;br&gt;render (Role.GetAttr.Arn &amp;quot;HelloWorldFunctionRole&amp;quot;)&lt;br&gt;```&lt;br&gt;&lt;br&gt;So the compiler can just help you find the correct attributes available.&lt;br&gt;&lt;br&gt;### Sam Policy Templates&lt;br&gt;Cloudformation&amp;#39;s Policy document is loosy type as just JSON, it is hard to get the policy right and too many boilerplates to create a Dhall JSON data&lt;br&gt;thanks to [AWS SAM](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-policy-templates.html) there are some common policy documents we can laverage&lt;br&gt;&lt;br&gt;these templates are translated into Dhall functions, so you don&amp;#39;t need to use SAM to be able to use these policy documents.&lt;br&gt;&lt;br&gt;```dhall&lt;br&gt;let Policy = https://github.com/jcouyang/dhall-aws-cloudformation/raw/${&lt;a href=&quot;#var1-5&quot; class=&quot;name-use&quot; data-name=&quot;var1-5&quot;&gt;version&lt;/a&gt;}/cloudformation/AWS::IAM::Role/Policy.dhall&lt;br&gt;let Sam/Policy = https://github.com/jcouyang/dhall-aws-cloudformation/raw/${&lt;a href=&quot;#var1-5&quot; class=&quot;name-use&quot; data-name=&quot;var1-5&quot;&gt;version&lt;/a&gt;}/sam/policy-template/package.dhall&lt;br&gt;...&lt;br&gt;  Policies = Some [Policy::{&lt;br&gt;    , PolicyDocument = Sam/Policy.DynamoDBReadPolicy (Fn.String &amp;quot;DBName&amp;quot;)&lt;br&gt;    , PolicyName = s &amp;quot;dynamo read only&amp;quot;&lt;br&gt;  }]&lt;br&gt;...&lt;br&gt;```&lt;br&gt;will generates&lt;br&gt;```json&lt;br&gt;{&lt;br&gt;  &amp;quot;Policies&amp;quot;: [&lt;br&gt;    {&lt;br&gt;      &amp;quot;PolicyDocument&amp;quot;: {&lt;br&gt;        &amp;quot;Statement&amp;quot;: [&lt;br&gt;          {&lt;br&gt;            &amp;quot;Action&amp;quot;: [&lt;br&gt;              &amp;quot;dynamodb:GetItem&amp;quot;,&lt;br&gt;              &amp;quot;dynamodb:Scan&amp;quot;,&lt;br&gt;              &amp;quot;dynamodb:Query&amp;quot;,&lt;br&gt;              &amp;quot;dynamodb:BatchGetItem&amp;quot;,&lt;br&gt;              &amp;quot;dynamodb:DescribeTable&amp;quot;&lt;br&gt;            ],&lt;br&gt;            &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,&lt;br&gt;            &amp;quot;Resource&amp;quot;: [&lt;br&gt;              {&lt;br&gt;                &amp;quot;Fn::Sub&amp;quot;: [&lt;br&gt;                  &amp;quot;arn:&amp;#39;&amp;#39;${AWS::Partition}:dynamodb:&amp;#39;&amp;#39;${AWS::Region}:&amp;#39;&amp;#39;${AWS::AccountId}:table/&amp;#39;&amp;#39;${tableName}&amp;quot;,&lt;br&gt;                  {&lt;br&gt;                    &amp;quot;tableName&amp;quot;: &amp;quot;DBName&amp;quot;&lt;br&gt;                  }&lt;br&gt;                ]&lt;br&gt;              },&lt;br&gt;              {&lt;br&gt;                &amp;quot;Fn::Sub&amp;quot;: [&lt;br&gt;                  &amp;quot;arn:&amp;#39;&amp;#39;${AWS::Partition}:dynamodb:&amp;#39;&amp;#39;${AWS::Region}:&amp;#39;&amp;#39;${AWS::AccountId}:table/&amp;#39;&amp;#39;${tableName}/index/*&amp;quot;,&lt;br&gt;                  {&lt;br&gt;                    &amp;quot;tableName&amp;quot;: &amp;quot;DBName&amp;quot;&lt;br&gt;                  }&lt;br&gt;                ]&lt;br&gt;              }&lt;br&gt;            ]&lt;br&gt;          }&lt;br&gt;        ]&lt;br&gt;      },&lt;br&gt;      &amp;quot;PolicyName&amp;quot;: &amp;quot;dynamo read only&amp;quot;&lt;br&gt;    }&lt;br&gt;  ]&lt;br&gt;}&lt;br&gt;```&lt;br&gt;## :coffee: Contribute&lt;br&gt;### Build and Test&lt;br&gt;&lt;br&gt;```&lt;br&gt;&amp;gt; nix-shell&lt;br&gt;$ cabal build&lt;br&gt;$ cabal test&lt;br&gt;```&lt;br&gt;### Generate Type Definitions&lt;br&gt;e definitions are generated from config file `./config.dhall` which contains specifications used by [AWS CDK](https://github.com/aws/aws-cdk/blob/master/packages/%40aws-cdk/cfnspec/build-tools/update.sh) as well:&lt;br&gt;${&lt;a href=&quot;#var5-5&quot; class=&quot;name-use&quot; data-name=&quot;var5-5&quot;&gt;fold&lt;/a&gt;&lt;br&gt;    { mapKey : Text, mapValue : Text }&lt;br&gt;    &lt;a href=&quot;#var3-5&quot; class=&quot;name-use&quot; data-name=&quot;var3-5&quot;&gt;config&lt;/a&gt;.specifications&lt;br&gt;Text&lt;br&gt;    ( λ(&lt;span id=&quot;var167-9&quot; class=&quot;name-decl&quot; data-name=&quot;var167-9&quot;&gt;x&lt;/span&gt; : { &lt;span id=&quot;var167-15&quot; class=&quot;name-decl&quot; data-name=&quot;var167-15&quot;&gt;mapKey&lt;/span&gt; : Text, &lt;span id=&quot;var167-30&quot; class=&quot;name-decl&quot; data-name=&quot;var167-30&quot;&gt;mapValue&lt;/span&gt; : Text }) →&lt;br&gt;      λ(&lt;span id=&quot;var168-9&quot; class=&quot;name-decl&quot; data-name=&quot;var168-9&quot;&gt;y&lt;/span&gt; : Text) →&lt;br&gt;        &amp;#39;&amp;#39;&lt;br&gt;        - [${&lt;a href=&quot;#var167-9&quot; class=&quot;name-use&quot; data-name=&quot;var167-9&quot;&gt;x&lt;/a&gt;.&lt;a href=&quot;#var167-15&quot; class=&quot;name-use&quot; data-name=&quot;var167-15&quot;&gt;mapKey&lt;/a&gt;}](${&lt;a href=&quot;#var167-9&quot; class=&quot;name-use&quot; data-name=&quot;var167-9&quot;&gt;x&lt;/a&gt;.&lt;a href=&quot;#var167-30&quot; class=&quot;name-use&quot; data-name=&quot;var167-30&quot;&gt;mapValue&lt;/a&gt;})&lt;br&gt;        ${&lt;a href=&quot;#var168-9&quot; class=&quot;name-use&quot; data-name=&quot;var168-9&quot;&gt;y&lt;/a&gt;}&amp;#39;&amp;#39;&lt;br&gt;    )&lt;br&gt;    &amp;quot;&amp;quot;}&lt;br&gt;regenerate types definition files, simply run&lt;br&gt;```&lt;br&gt;$ cabal run&lt;br&gt;```&lt;br&gt;if you just want to regenerate dhall files without setting up haskell dev environment, just&lt;br&gt;```sh&lt;br&gt;docker run --rm -v $(pwd):/data -w /data ghcr.io/jcouyang/dhall-aws-cloudformation&lt;br&gt;```&lt;br&gt;## :warning: Known Issue&lt;br&gt;The following CloudFormation definitions will raise assertion error due to invalid type definition such as empty type or cyclic import&lt;br&gt;${&lt;a href=&quot;#var5-5&quot; class=&quot;name-use&quot; data-name=&quot;var5-5&quot;&gt;fold&lt;/a&gt;&lt;br&gt;    Text&lt;br&gt;    &lt;a href=&quot;#var3-5&quot; class=&quot;name-use&quot; data-name=&quot;var3-5&quot;&gt;config&lt;/a&gt;.excludes&lt;br&gt;    Text&lt;br&gt;    ( λ(&lt;span id=&quot;var188-9&quot; class=&quot;name-decl&quot; data-name=&quot;var188-9&quot;&gt;x&lt;/span&gt; : Text) →&lt;br&gt;      λ(&lt;span id=&quot;var189-9&quot; class=&quot;name-decl&quot; data-name=&quot;var189-9&quot;&gt;y&lt;/span&gt; : Text) →&lt;br&gt;        &amp;#39;&amp;#39;&lt;br&gt;        - `${&lt;a href=&quot;#var188-9&quot; class=&quot;name-use&quot; data-name=&quot;var188-9&quot;&gt;x&lt;/a&gt;}`&lt;br&gt;        ${&lt;a href=&quot;#var189-9&quot; class=&quot;name-use&quot; data-name=&quot;var189-9&quot;&gt;y&lt;/a&gt;}&amp;#39;&amp;#39;&lt;br&gt;    )&lt;br&gt;    &amp;quot;&amp;quot;}&lt;br&gt;&amp;#39;&amp;#39;&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</div></div></body></html>