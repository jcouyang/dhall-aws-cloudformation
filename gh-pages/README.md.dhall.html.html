<!DOCTYPE HTML><html><head><title>/gh-pages/README.md.dhall.html</title><link rel="stylesheet" type="text/css" href="../index.css"><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&amp;family=Lato:ital,wght@0,400;0,700;1,400&amp;display=swap"><script type="text/javascript" src="../index.js"></script><meta charset="UTF-8"></head><body><div class="nav-bar"><img class="dhall-icon" src="../dhall-icon.svg"><p class="package-title">dhall-aws-cloudformation</p><div class="nav-bar-content-divider"></div><a id="switch-light-dark-mode" class="nav-option">Switch Light/Dark Mode</a></div><div class="main-container"><h2 class="doc-title"><span class="crumb-divider">/</span><a href="../index.html">dhall-aws-cloudformation</a><span class="crumb-divider">/</span><a class="title-crumb" href="index.html">gh-pages</a><span class="crumb-divider">/</span><span class="title-crumb" href="index.html">README.md.dhall.html</span></h2><a class="copy-to-clipboard" data-path="https://raw.githubusercontent.com/jcouyang/dhall-aws-cloudformation/0.9.79/gh-pages/README.md.dhall.html"><i><small>Copy path to clipboard</small></i></a><br><h3>Source</h3><div class="source-code">&lt;!DOCTYPE HTML&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;/README.md.dhall&lt;/title&gt;&lt;link href=&quot;index.css&quot; type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;&lt;link href=&quot;https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&amp;amp;family=Lato:ital,wght@0,400;0,700;1,400&amp;amp;display=swap&quot; type=&quot;text/css&quot; rel=&quot;stylesheet&quot;&gt;&lt;script src=&quot;index.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;nav-bar&quot;&gt;&lt;img src=&quot;dhall-icon.svg&quot; class=&quot;dhall-icon&quot;&gt;&lt;p class=&quot;package-title&quot;&gt;dhall-aws-cloudformation&lt;/p&gt;&lt;div class=&quot;nav-bar-content-divider&quot;&gt;&lt;/div&gt;&lt;a id=&quot;switch-light-dark-mode&quot; class=&quot;nav-option&quot;&gt;Switch Light/Dark Mode&lt;/a&gt;&lt;/div&gt;&lt;div class=&quot;main-container&quot;&gt;&lt;h2 class=&quot;doc-title&quot;&gt;&lt;span class=&quot;crumb-divider&quot;&gt;/&lt;/span&gt;&lt;a href=&quot;index.html&quot;&gt;dhall-aws-cloudformation&lt;/a&gt;&lt;span class=&quot;crumb-divider&quot;&gt;/&lt;/span&gt;&lt;span href=&quot;index.html&quot; class=&quot;title-crumb&quot;&gt;README.md.dhall&lt;/span&gt;&lt;/h2&gt;&lt;a data-path=&quot;https://raw.githubusercontent.com/jcouyang/dhall-aws-cloudformation/0.9.69/README.md.dhall&quot; class=&quot;copy-to-clipboard&quot;&gt;&lt;i&gt;&lt;small&gt;Copy path to clipboard&lt;/small&gt;&lt;/i&gt;&lt;/a&gt;&lt;br&gt;&lt;div class=&quot;doc-contents&quot;&gt;&lt;/div&gt;&lt;h3&gt;Source&lt;/h3&gt;&lt;div class=&quot;source-code&quot;&gt;&lt;pre&gt;let &lt;span data-name=&quot;var1-5&quot; id=&quot;var1-5&quot; class=&quot;name-decl&quot;&gt;version&lt;/span&gt; = &lt;a href=&quot;./version.dhall.html&quot;&gt;./version.dhall&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span data-name=&quot;var3-5&quot; id=&quot;var3-5&quot; class=&quot;name-decl&quot;&gt;config&lt;/span&gt; = &lt;a href=&quot;./config.dhall.html&quot;&gt;./config.dhall&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span data-name=&quot;var5-5&quot; id=&quot;var5-5&quot; class=&quot;name-decl&quot;&gt;fold&lt;/span&gt; =&lt;br&gt;      &lt;a href=&quot;https://github.com/dhall-lang/dhall-lang/raw/v20.0.0/Prelude/List/fold.dhall&quot; target=&quot;_blank&quot;&gt;https://github.com/dhall-lang/dhall-lang/raw/v20.0.0/Prelude/List/fold.dhall&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span data-name=&quot;var8-5&quot; id=&quot;var8-5&quot; class=&quot;name-decl&quot;&gt;exampleText&lt;/span&gt; = &lt;a href=&quot;./examples/readme.gen.dhall.html&quot;&gt;./examples/readme.gen.dhall as Text&lt;/a&gt;&lt;br&gt;&lt;br&gt;let &lt;span data-name=&quot;var10-5&quot; id=&quot;var10-5&quot; class=&quot;name-decl&quot;&gt;exampleResult&lt;/span&gt; = &lt;a href=&quot;./examples/readme.gen.json.html&quot;&gt;./examples/readme.gen.json as Text&lt;/a&gt;&lt;br&gt;&lt;br&gt;in  &amp;#39;&amp;#39;&lt;br&gt;    # Dhall AWS CloudFormation&lt;br&gt;&lt;br&gt;    `dhall-aws-cloudformation` contains [Dhall](https://github.com/dhall-lang/dhall-lang) bindings to AWS CloudFormation, so you can generate CloudFormation template from Dhall expressions. This will let you easily typecheck, template and modularize your CloudFormation definitions.&lt;br&gt;&lt;br&gt;    ## :mag: [References](https://oyanglul.us/dhall-aws-cloudformation/package.dhall.html)&lt;br&gt;    ## :bulb: [Examples](https://oyanglul.us/dhall-aws-cloudformation/examples/index.html)&lt;br&gt;&lt;br&gt;    ## :book: Usage&lt;br&gt;&lt;br&gt;    ### Use resource schema&lt;br&gt;    AWS Cloudformation has massive amount of specifications, to load all `package.dhall` remotely will be very slow&lt;br&gt;&lt;br&gt;    It is recommended to just import the only resources you need&lt;br&gt;&lt;br&gt;    &amp;gt;  optionaly, if you really need all resources in `package.dhall`, [load the binary cache to local first](https://oyanglul.us/dhall-aws-cloudformation/package.dhall.html#load-packagedhall-binary-to-local-cache)&lt;br&gt;&lt;br&gt;    ```dhall&lt;br&gt;    ${&lt;a href=&quot;#var8-5&quot; data-name=&quot;var8-5&quot; class=&quot;name-use&quot;&gt;exampleText&lt;/a&gt;}```&lt;br&gt;&lt;br&gt;    to convert to CloudFormation JSON file just&lt;br&gt;    ```&lt;br&gt;    dhall-to-json &amp;lt; ./template.dhall &amp;gt; ./template.json&lt;br&gt;    ```&lt;br&gt;&lt;br&gt;    generates&lt;br&gt;&lt;br&gt;    ```json&lt;br&gt;    ${&lt;a href=&quot;#var10-5&quot; data-name=&quot;var10-5&quot; class=&quot;name-use&quot;&gt;exampleResult&lt;/a&gt;}```&lt;br&gt;&lt;br&gt;    ### Intrinsic Function&lt;br&gt;&lt;br&gt;    The following intrinsic functions are implemented, you can find examples of using intrinsic function in [Fn.dhall document](https://oyanglul.us/dhall-aws-cloudformation/Fn.dhall.html)&lt;br&gt;    - [x] Fn::Base64&lt;br&gt;    - [x] Fn::Cidr&lt;br&gt;    - [x] Condition functions&lt;br&gt;    - [x] Fn::FindInMap&lt;br&gt;    - [x] Fn::GetAtt&lt;br&gt;    - [x] Fn::GetAZs&lt;br&gt;    - [x] Fn::ImportValue&lt;br&gt;    - [x] Fn::Join&lt;br&gt;    - [x] Fn::Select&lt;br&gt;    - [x] Fn::Split&lt;br&gt;    - [x] Fn::Sub&lt;br&gt;    - [x] Fn::Transform&lt;br&gt;    - [x] Ref&lt;br&gt;&lt;br&gt;    ### Type Safe `Fn::GetAttr`&lt;br&gt;    Instead of manually looking for AWS documents to make sure the resource has what attributes, we can just use `&amp;lt;Resource&amp;gt;.GetAttr.&amp;lt;attribute name&amp;gt;`:&lt;br&gt;&lt;br&gt;    ```dhall&lt;br&gt;    render (Role.GetAttr.Arn &amp;quot;HelloWorldFunctionRole&amp;quot;)&lt;br&gt;    ```&lt;br&gt;&lt;br&gt;    So the compiler can just help you find the correct attributes available.&lt;br&gt;&lt;br&gt;    ### Sam Policy Templates&lt;br&gt;    Cloudformation&amp;#39;s Policy document is loosy type as just JSON, it is hard to get the policy right and too many boilerplates to create a Dhall JSON data&lt;br&gt;&lt;br&gt;    Thanks to [AWS SAM](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-policy-templates.html) there are some common policy documents we can laverage&lt;br&gt;&lt;br&gt;    All these templates are translated into Dhall functions, so you don&amp;#39;t need to use SAM to be able to use these policy documents.&lt;br&gt;&lt;br&gt;    ```dhall&lt;br&gt;    let Policy = https://github.com/jcouyang/dhall-aws-cloudformation/raw/${&lt;a href=&quot;#var1-5&quot; data-name=&quot;var1-5&quot; class=&quot;name-use&quot;&gt;version&lt;/a&gt;}/cloudformation/AWS::IAM::Role/Policy.dhall&lt;br&gt;    let Sam/Policy = https://github.com/jcouyang/dhall-aws-cloudformation/raw/${&lt;a href=&quot;#var1-5&quot; data-name=&quot;var1-5&quot; class=&quot;name-use&quot;&gt;version&lt;/a&gt;}/sam/policy-template/package.dhall&lt;br&gt;    ...&lt;br&gt;      Policies = Some [Policy::{&lt;br&gt;        , PolicyDocument = Sam/Policy.DynamoDBReadPolicy (Fn.String &amp;quot;DBName&amp;quot;)&lt;br&gt;        , PolicyName = s &amp;quot;dynamo read only&amp;quot;&lt;br&gt;      }]&lt;br&gt;    ...&lt;br&gt;    ```&lt;br&gt;&lt;br&gt;    will generates&lt;br&gt;&lt;br&gt;    ```json&lt;br&gt;    {&lt;br&gt;      &amp;quot;Policies&amp;quot;: [&lt;br&gt;        {&lt;br&gt;          &amp;quot;PolicyDocument&amp;quot;: {&lt;br&gt;            &amp;quot;Statement&amp;quot;: [&lt;br&gt;              {&lt;br&gt;                &amp;quot;Action&amp;quot;: [&lt;br&gt;                  &amp;quot;dynamodb:GetItem&amp;quot;,&lt;br&gt;                  &amp;quot;dynamodb:Scan&amp;quot;,&lt;br&gt;                  &amp;quot;dynamodb:Query&amp;quot;,&lt;br&gt;                  &amp;quot;dynamodb:BatchGetItem&amp;quot;,&lt;br&gt;                  &amp;quot;dynamodb:DescribeTable&amp;quot;&lt;br&gt;                ],&lt;br&gt;                &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;,&lt;br&gt;                &amp;quot;Resource&amp;quot;: [&lt;br&gt;                  {&lt;br&gt;                    &amp;quot;Fn::Sub&amp;quot;: [&lt;br&gt;                      &amp;quot;arn:&amp;#39;&amp;#39;${AWS::Partition}:dynamodb:&amp;#39;&amp;#39;${AWS::Region}:&amp;#39;&amp;#39;${AWS::AccountId}:table/&amp;#39;&amp;#39;${tableName}&amp;quot;,&lt;br&gt;                      {&lt;br&gt;                        &amp;quot;tableName&amp;quot;: &amp;quot;DBName&amp;quot;&lt;br&gt;                      }&lt;br&gt;                    ]&lt;br&gt;                  },&lt;br&gt;                  {&lt;br&gt;                    &amp;quot;Fn::Sub&amp;quot;: [&lt;br&gt;                      &amp;quot;arn:&amp;#39;&amp;#39;${AWS::Partition}:dynamodb:&amp;#39;&amp;#39;${AWS::Region}:&amp;#39;&amp;#39;${AWS::AccountId}:table/&amp;#39;&amp;#39;${tableName}/index/*&amp;quot;,&lt;br&gt;                      {&lt;br&gt;                        &amp;quot;tableName&amp;quot;: &amp;quot;DBName&amp;quot;&lt;br&gt;                      }&lt;br&gt;                    ]&lt;br&gt;                  }&lt;br&gt;                ]&lt;br&gt;              }&lt;br&gt;            ]&lt;br&gt;          },&lt;br&gt;          &amp;quot;PolicyName&amp;quot;: &amp;quot;dynamo read only&amp;quot;&lt;br&gt;        }&lt;br&gt;      ]&lt;br&gt;    }&lt;br&gt;    ```&lt;br&gt;    ## :coffee: Contribute&lt;br&gt;    ### Build and Test&lt;br&gt;&lt;br&gt;    ```&lt;br&gt;    &amp;gt; nix-shell&lt;br&gt;    $ stack build&lt;br&gt;    $ stack test&lt;br&gt;    ```&lt;br&gt;    ### Generate Type Definitions&lt;br&gt;&lt;br&gt;    Type definitions are generated from config file `./config.dhall` which contains specifications used by [AWS CDK](https://github.com/aws/aws-cdk/blob/master/packages/%40aws-cdk/cfnspec/build-tools/update.sh) as well:&lt;br&gt;    ${&lt;a href=&quot;#var5-5&quot; data-name=&quot;var5-5&quot; class=&quot;name-use&quot;&gt;fold&lt;/a&gt;&lt;br&gt;        { mapKey : Text, mapValue : Text }&lt;br&gt;        &lt;a href=&quot;#var3-5&quot; data-name=&quot;var3-5&quot; class=&quot;name-use&quot;&gt;config&lt;/a&gt;.specifications&lt;br&gt;        Text&lt;br&gt;        ( λ(&lt;span data-name=&quot;var144-13&quot; id=&quot;var144-13&quot; class=&quot;name-decl&quot;&gt;x&lt;/span&gt; : { &lt;span data-name=&quot;var144-19&quot; id=&quot;var144-19&quot; class=&quot;name-decl&quot;&gt;mapKey&lt;/span&gt; : Text, &lt;span data-name=&quot;var144-34&quot; id=&quot;var144-34&quot; class=&quot;name-decl&quot;&gt;mapValue&lt;/span&gt; : Text }) →&lt;br&gt;          λ(&lt;span data-name=&quot;var145-13&quot; id=&quot;var145-13&quot; class=&quot;name-decl&quot;&gt;y&lt;/span&gt; : Text) →&lt;br&gt;            &amp;#39;&amp;#39;&lt;br&gt;            - [${&lt;a href=&quot;#var144-13&quot; data-name=&quot;var144-13&quot; class=&quot;name-use&quot;&gt;x&lt;/a&gt;.&lt;a href=&quot;#var144-19&quot; data-name=&quot;var144-19&quot; class=&quot;name-use&quot;&gt;mapKey&lt;/a&gt;}](${&lt;a href=&quot;#var144-13&quot; data-name=&quot;var144-13&quot; class=&quot;name-use&quot;&gt;x&lt;/a&gt;.&lt;a href=&quot;#var144-34&quot; data-name=&quot;var144-34&quot; class=&quot;name-use&quot;&gt;mapValue&lt;/a&gt;})&lt;br&gt;            ${&lt;a href=&quot;#var145-13&quot; data-name=&quot;var145-13&quot; class=&quot;name-use&quot;&gt;y&lt;/a&gt;}&amp;#39;&amp;#39;&lt;br&gt;        )&lt;br&gt;        &amp;quot;&amp;quot;}&lt;br&gt;&lt;br&gt;    To regenerate types definition files, simply run&lt;br&gt;    ```&lt;br&gt;    $ stack run&lt;br&gt;    ```&lt;br&gt;&lt;br&gt;    Or if you just want to regenerate dhall files without setting up haskell dev environment, just&lt;br&gt;    ```sh&lt;br&gt;    docker run --rm -v $(pwd):/data -w /data ghcr.io/jcouyang/dhall-aws-cloudformation&lt;br&gt;    ```&lt;br&gt;&lt;br&gt;    ## :warning: Known Issue&lt;br&gt;    The following CloudFormation definitions will raise assertion error due to invalid type definition such as empty type or cyclic import&lt;br&gt;&lt;br&gt;    ${&lt;a href=&quot;#var5-5&quot; data-name=&quot;var5-5&quot; class=&quot;name-use&quot;&gt;fold&lt;/a&gt;&lt;br&gt;        Text&lt;br&gt;        &lt;a href=&quot;#var3-5&quot; data-name=&quot;var3-5&quot; class=&quot;name-use&quot;&gt;config&lt;/a&gt;.excludes&lt;br&gt;        Text&lt;br&gt;        ( λ(&lt;span data-name=&quot;var169-13&quot; id=&quot;var169-13&quot; class=&quot;name-decl&quot;&gt;x&lt;/span&gt; : Text) →&lt;br&gt;          λ(&lt;span data-name=&quot;var170-13&quot; id=&quot;var170-13&quot; class=&quot;name-decl&quot;&gt;y&lt;/span&gt; : Text) →&lt;br&gt;            &amp;#39;&amp;#39;&lt;br&gt;            - `${&lt;a href=&quot;#var169-13&quot; data-name=&quot;var169-13&quot; class=&quot;name-use&quot;&gt;x&lt;/a&gt;}`&lt;br&gt;            ${&lt;a href=&quot;#var170-13&quot; data-name=&quot;var170-13&quot; class=&quot;name-use&quot;&gt;y&lt;/a&gt;}&amp;#39;&amp;#39;&lt;br&gt;        )&lt;br&gt;        &amp;quot;&amp;quot;}&lt;br&gt;    &amp;#39;&amp;#39;&lt;br&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</div></div></body></html>